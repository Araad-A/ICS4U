const teams = [{
       "StandingId":1,
       "RoundId":1,
       "TeamId":514,
       "Name":"Leicester City FC",
       "ShortName":"Leicester City",
       "Scope":"Total",
       "Order":1,
       "Games":38,
       "Wins":23,
       "Losses":3,
       "Draws":0,
       "GoalsScored":0,
       "GoalsAgainst":0,
       "GoalsDifferential":0,
       "Points":58,
       "Group":null,
       "GlobalTeamID":90000514
    },
    {
       "StandingId":3,
       "RoundId":1,
       "TeamId":524,
       "Name":"Tottenham Hotspur FC",
       "ShortName":"Tottenham",
       "Scope":"Total",
       "Order":2,
       "Games":38,
       "Wins":19,
       "Losses":6,
       "Draws":0,
       "GoalsScored":0,
       "GoalsAgainst":0,
       "GoalsDifferential":0,
       "Points":51,
       "Group":null,
       "GlobalTeamID":90000524
    },
    {
       "StandingId":7,
       "RoundId":1,
       "TeamId":527,
       "Name":"West Ham United FC",
       "ShortName":"West Ham",
       "Scope":"Total",
       "Order":6,
       "Games":38,
       "Wins":16,
       "Losses":8,
       "Draws":0,
       "GoalsScored":0,
       "GoalsAgainst":0,
       "GoalsDifferential":0,
       "Points":46,
       "Group":null,
       "GlobalTeamID":90000527
    },
    {
       "StandingId":10,
       "RoundId":1,
       "TeamId":511,
       "Name":"Chelsea FC",
       "ShortName":"Chelsea",
       "Scope":"Total",
       "Order":9,
       "Games":38,
       "Wins":12,
       "Losses":12,
       "Draws":0,
       "GoalsScored":0,
       "GoalsAgainst":0,
       "GoalsDifferential":0,
       "Points":38,
       "Group":null,
       "GlobalTeamID":90000511
    },
    {
       "StandingId":11,
       "RoundId":1,
       "TeamId":513,
       "Name":"Everton FC",
       "ShortName":"Everton",
       "Scope":"Total",
       "Order":11,
       "Games":38,
       "Wins":11,
       "Losses":13,
       "Draws":0,
       "GoalsScored":0,
       "GoalsAgainst":0,
       "GoalsDifferential":0,
       "Points":36,
       "Group":null,
       "GlobalTeamID":90000513
    },
    {
       "StandingId":14,
       "RoundId":1,
       "TeamId":526,
       "Name":"West Bromwich Albion FC",
       "ShortName":"West Brom",
       "Scope":"Total",
       "Order":14,
       "Games":38,
       "Wins":10,
       "Losses":15,
       "Draws":0,
       "GoalsScored":0,
       "GoalsAgainst":0,
       "GoalsDifferential":0,
       "Points":33,
       "Group":null,
       "GlobalTeamID":90000526
    },
    {
       "StandingId":24,
       "RoundId":1,
       "TeamId":516,
       "Name":"Manchester City FC",
       "ShortName":"Man City",
       "Scope":"Home",
       "Order":4,
       "Games":19,
       "Wins":12,
       "Losses":5,
       "Draws":0,
       "GoalsScored":0,
       "GoalsAgainst":0,
       "GoalsDifferential":0,
       "Points":26,
       "Group":null,
       "GlobalTeamID":90000516
    },
    {
       "StandingId":26,
       "RoundId":1,
       "TeamId":520,
       "Name":"Southampton FC",
       "ShortName":"Southampton",
       "Scope":"Home",
       "Order":6,
       "Games":19,
       "Wins":11,
       "Losses":5,
       "Draws":0,
       "GoalsScored":0,
       "GoalsAgainst":0,
       "GoalsDifferential":0,
       "Points":25,
       "Group":null,
       "GlobalTeamID":90000520
    },
    {
       "StandingId":29,
       "RoundId":1,
       "TeamId":523,
       "Name":"Swansea City AFC",
       "ShortName":"Swansea",
       "Scope":"Home",
       "Order":9,
       "Games":19,
       "Wins":8,
       "Losses":5,
       "Draws":0,
       "GoalsScored":0,
       "GoalsAgainst":0,
       "GoalsDifferential":0,
       "Points":22,
       "Group":null,
       "GlobalTeamID":90000523
    },
    {
       "StandingId":34,
       "RoundId":1,
       "TeamId":525,
       "Name":"Watford FC",
       "ShortName":"Watford",
       "Scope":"Home",
       "Order":14,
       "Games":19,
       "Wins":6,
       "Losses":7,
       "Draws":0,
       "GoalsScored":0,
       "GoalsAgainst":0,
       "GoalsDifferential":0,
       "Points":18,
       "Group":null,
       "GlobalTeamID":90000525
    },
    {
       "StandingId":38,
       "RoundId":1,
       "TeamId":512,
       "Name":"Crystal Palace FC",
       "ShortName":"Crystal Palace",
       "Scope":"Home",
       "Order":18,
       "Games":19,
       "Wins":6,
       "Losses":10,
       "Draws":0,
       "GoalsScored":0,
       "GoalsAgainst":0,
       "GoalsDifferential":0,
       "Points":15,
       "Group":null,
       "GlobalTeamID":90000512
    },
    {
       "StandingId":39,
       "RoundId":1,
       "TeamId":508,
       "Name":"AFC Bournemouth",
       "ShortName":"Bournemouth",
       "Scope":"Home",
       "Order":19,
       "Games":19,
       "Wins":5,
       "Losses":9,
       "Draws":0,
       "GoalsScored":0,
       "GoalsAgainst":0,
       "GoalsDifferential":0,
       "Points":15,
       "Group":null,
       "GlobalTeamID":90000508
    },
    {
       "StandingId":43,
       "RoundId":1,
       "TeamId":509,
       "Name":"Arsenal FC",
       "ShortName":"Arsenal",
       "Scope":"Away",
       "Order":3,
       "Games":19,
       "Wins":8,
       "Losses":4,
       "Draws":0,
       "GoalsScored":0,
       "GoalsAgainst":0,
       "GoalsDifferential":0,
       "Points":23,
       "Group":null,
       "GlobalTeamID":90000509
    },
    {
       "StandingId":46,
       "RoundId":1,
       "TeamId":515,
       "Name":"Liverpool FC",
       "ShortName":"Liverpool",
       "Scope":"Away",
       "Order":6,
       "Games":19,
       "Wins":8,
       "Losses":7,
       "Draws":0,
       "GoalsScored":0,
       "GoalsAgainst":0,
       "GoalsDifferential":0,
       "Points":20,
       "Group":null,
       "GlobalTeamID":90000515
    },
    {
       "StandingId":49,
       "RoundId":1,
       "TeamId":517,
       "Name":"Manchester United FC",
       "ShortName":"Man United",
       "Scope":"Away",
       "Order":10,
       "Games":19,
       "Wins":7,
       "Losses":8,
       "Draws":0,
       "GoalsScored":0,
       "GoalsAgainst":0,
       "GoalsDifferential":0,
       "Points":18,
       "Group":null,
       "GlobalTeamID":90000517
    },
    {
       "StandingId":51,
       "RoundId":1,
       "TeamId":521,
       "Name":"Stoke City FC",
       "ShortName":"Stoke",
       "Scope":"Away",
       "Order":11,
       "Games":19,
       "Wins":6,
       "Losses":8,
       "Draws":0,
       "GoalsScored":0,
       "GoalsAgainst":0,
       "GoalsDifferential":0,
       "Points":17,
       "Group":null,
       "GlobalTeamID":90000521
    },
    {
       "StandingId":57,
       "RoundId":1,
       "TeamId":522,
       "Name":"Sunderland AFC",
       "ShortName":"Sunderland",
       "Scope":"Away",
       "Order":17,
       "Games":19,
       "Wins":3,
       "Losses":10,
       "Draws":0,
       "GoalsScored":0,
       "GoalsAgainst":0,
       "GoalsDifferential":0,
       "Points":12,
       "Group":null,
       "GlobalTeamID":90000522
    },
    {
       "StandingId":58,
       "RoundId":1,
       "TeamId":519,
       "Name":"Norwich City FC",
       "ShortName":"Norwich",
       "Scope":"Away",
       "Order":18,
       "Games":19,
       "Wins":3,
       "Losses":14,
       "Draws":0,
       "GoalsScored":0,
       "GoalsAgainst":0,
       "GoalsDifferential":0,
       "Points":8,
       "Group":null,
       "GlobalTeamID":90000519
    },
    {
       "StandingId":59,
       "RoundId":1,
       "TeamId":518,
       "Name":"Newcastle United FC",
       "ShortName":"Newcastle",
       "Scope":"Away",
       "Order":19,
       "Games":19,
       "Wins":2,
       "Losses":14,
       "Draws":0,
       "GoalsScored":0,
       "GoalsAgainst":0,
       "GoalsDifferential":0,
       "Points":7,
       "Group":null,
       "GlobalTeamID":90000518
    },
    {
       "StandingId":60,
       "RoundId":1,
       "TeamId":510,
       "Name":"Aston Villa FC",
       "ShortName":"Aston Villa",
       "Scope":"Away",
       "Order":20,
       "Games":19,
       "Wins":1,
       "Losses":15,
       "Draws":0,
       "GoalsScored":0,
       "GoalsAgainst":0,
       "GoalsDifferential":0,
       "Points":5,
       "Group":null,
       "GlobalTeamID":90000510
    }
 ];
//This is to reset the array
//let teamStandings = JSON.parse(JSON.stringify(teams));

//let newTeamStandings = localStorage.getItem("teamStandings");
//let teamStandings = newTeamStandings != null ? JSON.parse(newTeamStandings) : JSON.parse(teamStandings);
let teamStandings = JSON.parse(JSON.stringify(teams));
console.log(teamStandings);

let sortedStandings = teamStandings;
let filteredStandings = teamStandings;

let currentSortField = "Wins";
let sortDirection = "ASC";

let pageNum = 1;
let max = Math.ceil(teamStandings.length/10)

let homeTeamName = window.localStorage.getItem("homeTeamName");
let homeTeamWins = window.localStorage.getItem("homeTeamWins");
let homeTeamLosses = window.localStorage.getItem("homeTeamLosses");
let homeTeamDraws = window.localStorage.getItem("homeTeamDraws");
let homeTeamPoints = window.localStorage.getItem("homeTeamPoints");

let awayTeamName = window.localStorage.getItem("awayTeamName");
let awayTeamWins = window.localStorage.getItem("awayTeamWins");
let awayTeamLosses = window.localStorage.getItem("awayTeamLosses");
let awayTeamDraws = window.localStorage.getItem("awayTeamDraws");
let awayTeamPoints = window.localStorage.getItem("awayTeamPoints");

addTeam(homeTeamName, homeTeamWins, homeTeamLosses, homeTeamDraws, homeTeamPoints);
addTeam(awayTeamName, awayTeamWins, awayTeamLosses, awayTeamDraws, awayTeamPoints);

function createRow(team) {
   let newRow = document.createElement('tr');
   newRow.setAttribute('scope', 'row');
   let newCell = document.createElement('td');
   newCell.appendChild(document.createTextNode(team.Name));
   newRow.appendChild(newCell);
   newCell = document.createElement('td');
   newCell.appendChild(document.createTextNode(team.Wins));
   newRow.appendChild(newCell);
   newCell = document.createElement('td');
   newCell.appendChild(document.createTextNode(team.Losses));
   newRow.appendChild(newCell);
   newCell = document.createElement('td');
   newCell.appendChild(document.createTextNode(team.Draws));
   newRow.appendChild(newCell);
   newCell = document.createElement('td');
   newCell.appendChild(document.createTextNode(team.Points));
   newRow.appendChild(newCell);

   return newRow;
}

let filteredPage = teamStandings.slice(pageNum*10-10, pageNum*10);

function createPage() {
   document.querySelector('#rows').innerHTML = '';
   filteredPage.forEach(team => {let row = createRow(team); document.querySelector('#rows').appendChild(row);});
}

function sort(field){
   if (field === undefined){
      currentSortField = field;
   }else if (field === currentSortField){
      sortDirection = sortDirection === "ASC" ? "DESC" : "ASC";
   }else {
      sortDirection = "ASC";
      currentSortField = field;
   }

   if (sortDirection == "ASC"){
         if (field ==="Name"){
            sortedStandings = teamStandings.sort((a, b) => a.Name.localeCompare(b.Name) > 0 ? 1 : -1);
         }else if (field === "Wins"){
            sortedStandings = teamStandings.sort((a,b) => a.Wins - b.Wins);
         }else if (field === "Losses"){
            sortedStandings = teamStandings.sort((a,b) => a.Losses-b.Losses);
         }else if (field === "Draws"){
            sortedStandings = teamStandings.sort((a,b) => a.Draws - b.Draws);
         }else if (field === "Points"){
            sortedStandings = teamStandings.sort((a,b) => a.Points - b.Points);
         }
      }
   else{
         if (field ==="Name"){
            sortedStandings = teamStandings.sort((a, b) => a.Name.localeCompare(b.Name) < 0 ? 1 : -1);
         }else if (field === "Wins"){
            sortedStandings = teamStandings.sort((a,b) => b.Wins - a.Wins);
         }else if (field === "Losses"){
            sortedStandings = teamStandings.sort((a,b) => b.Losses-a.Losses);
         }else if (field === "Draws"){
            sortedStandings = teamStandings.sort((a,b) => b.Draws - a.Draws);
         }else if (field === "Points"){
            sortedStandings = teamStandings.sort((a,b) => b.Points - a.Points);
         }
   }
   filteredPage = sortedStandings.slice(pageNum*10-10, pageNum*10);
   createPage();
}

function addTeam(name, wins, losses, draws, points){
   name = checkTeam(teamStandings, name); 
   newTeam = {
      Name : name,
      Wins : wins,
      Losses : losses, 
      Draws : draws, 
      Points : points
   }
   teamStandings.push(newTeam);
   checkNewTeam(); 
   sortData(); 
}                      

function checkTeam(standings, name){
   let answer = true;
   for (j = 0; j < standings.length; j++){
         if (name == standings[j].Name || name == standings[j].ShortName){
            name = standings[j].Name
            console.log(name);
            let index = standings.findIndex(team => team.Name == name);
            standings.splice(index, 1)
            return name;
         }else if (homeTeamName != standings[j].Name && homeTeamName != standings[j].Name){
            answer = false;
         }  
   }
   if (answer == false){
      return name;
   }
}

function checkNewTeam(){
   let index = teamStandings.indexOf(newTeam);
   if (teamStandings[index].Name == teamStandings[index-2].Name){
      teamStandings.pop();
      teamStandings.pop(); 
   }
   if (homeTeamName == null || homeTeamWins == null || homeTeamLosses == null || homeTeamDraws == null || homeTeamPoints == null || awayTeamName == null || awayTeamWins == null || awayTeamLosses == null || awayTeamDraws == null || awayTeamPoints == null){
      let indexNull = teamStandings.indexOf(null);
      teamStandings.splice(indexNull, 2);
   }
}

function sortData(){
   window.localStorage.setItem('teamStandings', JSON.stringify(teamStandings));
}

function filterTeams(){
   let filterValue = document.querySelector("#filter").value;
   filteredPage = teamStandings.filter(teamStandings => (teamStandings.Name.toLowerCase().indexOf(filterValue.toLowerCase()) === 0));;
   createPage(); 
   console.log(filteredPage);
}

function changePage(input){
   if(input===0&&pageNum>1)
       pageNum--;
   else if(input===1&&pageNum<max)
       pageNum++;
   sort(undefined);
}

createPage();